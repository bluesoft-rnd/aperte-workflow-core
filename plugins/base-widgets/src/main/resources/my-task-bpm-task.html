<div class="process-tasks-view">
    <table id="${queueId}-table" class="process-table table table-striped" border="1">
        <thead>
        <th style="width:10%;">${messageSource.getMessage("processes.list.table.process.name")}</th>
        <th style="width:10%;">${messageSource.getMessage("processes.list.table.process.step")}</th>
		<th style="width:10%;">${messageSource.getMessage("processes.list.table.process.code")}</th>
		<th style="width:10%;">${messageSource.getMessage("processes.list.table.process.businessStatus")}</th>
        <th style="width:10%;">${messageSource.getMessage("processes.list.table.process.creator")}</th>
		<th style="width:10%;">${messageSource.getMessage("processes.list.table.process.assignee")}</th>
		<th style="width:10%;">${messageSource.getMessage("processes.list.table.process.creationdate")}</th>
		<th style="width:10%;">${messageSource.getMessage("processes.list.table.process.assignDate")}</th>
        </thead>
        <tbody></tbody>
    </table>

    <button type="button" id="clear-sorting-button-${queueId}" style="clear: left; float:left;" class="btn btn-primary btn-xs">${messageSource.getMessage("processes.list.table.clear.sorting")}</button>
    <div id="search-process-table" style="float:left; margin-left:5px;">
        <input type="text" id="processInputTextField" class="input-medium" placeholder="${messageSource.getMessage('processes.search.label')}">
    </div>
</div>


<script type="text/javascript">

    var dataTable_${queueId};
  	$(document).ready(function()
	{
		var loadedProcess = loadCookies("process");
		var parsedProcess = parseCookie(loadedProcess);
		
		dataTable_${queueId} = new AperteDataTable("${queueId}-table",
			[
				 { "name":"name","orderable": true ,"visible":parsedProcess.name, "data": function(object){return generateNameColumn(object);}},
				 { "name":"step","orderable": true ,"visible":parsedProcess.step, "data": "step" },
				 { "name":"code","orderable": true ,"visible":parsedProcess.code, "data": "code" },
				 { "name":"businessStatus","orderable": true ,"visible":parsedProcess.businessStatus, "data": "businessStatus" },
				 { "name":"creator", "orderable": true ,"visible":parsedProcess.creator,"data": "creator" },
				 { "name":"assignee", "orderable": true ,"visible":parsedProcess.assignee,"data": "assignee" },
				 { "name":"creationDate", "orderable": true ,"visible":parsedProcess.creationDate,"data": function(object){return moment(object.creationDate).format('DD-MM-YYYY, HH:mm:ss');}},
				 { "name":"taskAssignDate", "orderable": true ,"visible":parsedProcess.taskAssignDate,"data": function(object){return moment(object.taskAssignDate).format('DD-MM-YYYY, HH:mm:ss');}}
			],
			[[ 4, "desc" ], [ 5, "asc" ]],
			{
				pageLength: 25
            }
		);

		dataTable_${queueId}.addParameter('taskListViewName','myTasks');
		dataTable_${queueId}.addParameter('queueType','process');
		dataTable_${queueId}.addParameter('ownerLogin','${ownerLogin}');
		dataTable_${queueId}.addParameter('noTransaction','true');

		queueViewManager.addTableView('myTasks', dataTable_${queueId}, 'taskListViewName');

        dataTable_${queueId}.reloadTable(processListPortlet);

        $('#clear-sorting-button-${queueId}').unbind("click").click( function()
        {
            $('#processInputTextField').val('');

            dataTable_${queueId}.dataTable
            .order( [ 4, "desc" ], [ 5, "asc" ] )
            .search('')
            .draw();
        });

        $("#${queueId}-table").on('draw.dt', function () {
            var info = dataTable_${queueId}.dataTable.page.info();
            $('#queue-counter-${queueId}-${ownerLogin}').html(info.recordsTotal);
        } );

        $("#${queueId}-table").on("remove", function () {
            dataTable_${queueId}.dataTable.fnDestroy();
            window[reloadQueue_${queueId}] = null;
        })
	});

	function reloadQueue_myTasks()
	{
        dataTable_${queueId}.reloadTable(processListPortlet);
	}

	function getTitle(task)
	{
	    if(task.title)
	        return task.title;

	    return "";
	}

	
	function generateStatusColumn(task)
	{
		if(!task.businessStatus)
		{
			return "";
		}
		else
		{

		    if(task.highlight)
		    {
		        return '<font color="red">'+task.businessStatus+'</font>';
		    }

			return task.businessStatus;
		}
	}
	
	function generateAssigneColumn(task)
	{
		if(task.assignee)
		{
		    return task.assignee;
		}
		else if(task.group)
		{
			return "group.name." + task.group;
		}
	}


	function generateNameColumn(task)
	{
		var showOnClickCode = 'onclick="loadProcessView('+task.taskId+')"';
		
	    var linkBody = '<a class="process-view-link"  '+showOnClickCode+' >' + task.processName + '</a>';

        return linkBody;
    }

    $('#processInputTextField').keyup(function()
    {
        delay(function(){
          $('#${queueId}-table').dataTable().fnFilter( $('#processInputTextField').val() );
        }, 500 );
    });
//]]>
</script>